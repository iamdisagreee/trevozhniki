services:
#  posts_service:
#    build: ./messages_service
#    ports:
#      - "127.0.0.1:8001:8000"
#    volumes:
#      - posts_db_data:/app/data
  messages_service_pg:
    image: postgres:latest
    env_file:
      - messages_service/app/.env
    container_name: messages_service_pg
    volumes:
      - messages_service_pg_data:/var/lib/postgresql/data
#    environment:
#      POSTGRES_DB: ${POSTGRES_DB}
#      POSTGRES_USER: ${POSTGRES_USER}
#      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    ports:
      - 5433:5432
    restart: on-failure

  auth_service_pg:
    image: postgres:latest
    env_file:
      - auth_service/app/.env
    container_name: auth_service_pg
    volumes:
      - auth_service_pg_data:/var/lib/postgresql/data
    ports:
      - 5432:5432
    restart: on-failure

  auth_service_redis:
    image: redis:latest
    env_file:
      - auth_service/app/.env
    container_name: auth_service_redis
    #command:
    #  - redis-server --requirepass $$10092025
    volumes:
      - auth_service_redis_data:/data
    ports:
      - 6379:6379
    restart: on-failure

  rabbitmq:
    image: rabbitmq:4.1.1-management-alpine
    ports:
      - "127.0.0.1:5672:5672"     # üëà –ø–æ—Ä—Ç AMQP
      - "127.0.0.1:15672:15672" # –ü–æ—Ä—Ç –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ RabbitMQ Management
    environment:
      RABBITMQ_DEFAULT_USER: user
      RABBITMQ_DEFAULT_PASS: user
    healthcheck:
      test: [ "CMD", "rabbitmq-diagnostics", "check_port_connectivity" ]
      interval: 10s
      timeout: 5s
      retries: 5


volumes:
  messages_service_pg_data:
  auth_service_pg_data:
  auth_service_redis_data: